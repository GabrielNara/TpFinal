<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estadísticas</title>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
</head>
<body>
{{> header}}

<!-- Breadcrumb -->
<nav class="flex px-5 py-3 text-gray-700 border border-gray-200 rounded-lg bg-gray-50 dark:bg-gray-800 dark:border-gray-700"
     aria-label="Breadcrumb">
    <ol class="inline-flex items-center space-x-1 md:space-x-3">
        <li class="inline-flex items-center">
            <a href="/tpFinal/lobby/list"
               class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-blue-600 dark:text-gray-400 dark:hover:text-white">
                <svg aria-hidden="true" class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20"
                     xmlns="http://www.w3.org/2000/svg">
                    <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path>
                </svg>
                Lobby
            </a>
        </li>
        <li>
            <div class="flex items-center">
                <svg aria-hidden="true" class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20"
                     xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                          d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                          clip-rule="evenodd"></path>
                </svg>
                <a href="/tpFinal/administrador/estadisticas"
                   class="ml-1 text-sm font-medium text-gray-700 hover:text-blue-600 md:ml-2 dark:text-gray-400 dark:hover:text-white">Estadisticas</a>
            </div>
        </li>
        <li aria-current="page">
            <div class="flex items-center">
                <svg aria-hidden="true" class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20"
                     xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                          d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                          clip-rule="evenodd"></path>
                </svg>
                <span class="ml-1 text-sm font-medium text-gray-500 md:ml-2 dark:text-gray-400">...</span>
            </div>
        </li>
    </ol>
</nav>

<div class="flex flex-col items-center justify-center border border-gray-300 rounded-lg p-4 mb-4">
    <h1 id="chart_title" class="text-3xl"></h1>
    <input type="text" id="datepicker" placeholder="Seleccione una fecha">
</div>

<div class="flex flex-col items-center justify-center border border-gray-300 rounded-lg p-4 mb-4">
    <h1 id="chart_title" class="text-3xl"></h1>
    <button onclick="ultimaSemanaChart()">Mostrar últimos 7 días</button>
</div>

<div class="flex flex-col items-center justify-center border border-gray-300 rounded-lg p-4 mb-4">
    <h1 id="chart_title" class="text-3xl"></h1>
    <select id="mesSelector" class="mb-2">
        <option value="1">Enero</option>
        <option value="2">Febrero</option>
        <option value="3">Marzo</option>
        <option value="4">Abril</option>
        <option value="5">Mayo</option>
        <option value="6">Junio</option>
        <option value="7">Julio</option>
        <option value="8">Agosto</option>
        <option value="9">Septiembre</option>
        <option value="10">Octubre</option>
        <option value="11">Noviembre</option>
        <option value="12">Diciembre</option>
    </select>
    <button onclick="mesChart()">Generar Gráfico por Mes</button>
</div>

<div class="flex flex-col items-center justify-center border border-gray-300 rounded-lg p-4 mb-4">
    <h1 id="chart_title" class="text-3xl"></h1>
    <select id="anioSelector" class="mb-2">
        <option value="2018">2018</option>
        <option value="2019">2019</option>
        <option value="2020">2020</option>
        <option value="2021">2021</option>
        <option value="2022">2022</option>
        <option value="2023">2023</option>
    </select>
    <button onclick="anioChart()">Generar Gráfico por Año</button>
</div>

<div id="chart_div"></div>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script type="text/javascript">
    google.charts.load('current', {packages: ['corechart', 'controls']});
    google.charts.setOnLoadCallback(drawChart);

    $(document).ready(function() {
        $('#datepicker').datepicker({
            dateFormat: 'yy-mm-dd',
            onSelect: function(date) {
                // Se ejecuta cuando se selecciona una fecha
                generateChart(date);
            }
        });
    });
    function generateChart(selectedDate) {
        var url = '/tpFinal/administrador/cantidadJugadorPorSexoDia';

        $.ajax({
            url: url,
            type: 'GET',
            dataType: 'json',
            data: { date: selectedDate },

            success: function(response) {
                console.log(response);
                drawChart(response);
            },

            error: function(xhr, status, error) {
                console.error(xhr.responseText);
            }
        });
    }

    function formatDate(date) {
        var year = date.getFullYear();
        var month = String(date.getMonth() + 1).padStart(2, '0');
        var day = String(date.getDate()).padStart(2, '0');
        return year + '-' + month + '-' + day;
    }
    function ultimaSemanaChart() {
        // Obtener la fecha actual y calcular la fecha hace una semana
        var today = new Date();
        var lastWeek = new Date();
        lastWeek.setDate(today.getDate() - 7);

        // Formatear las fechas en el formato deseado (yyyy-mm-dd)
        var formattedToday = formatDate(today);
        var formattedLastWeek = formatDate(lastWeek);

        generateChartSemanal(formattedLastWeek, formattedToday);
    }

    function generateChartSemanal(startDate, endDate) {
        var url = '/tpFinal/administrador/cantidadJugadorPorSexoSemanal';

        $.ajax({
            url: url,
            type: 'GET',
            dataType: 'json',
            data: { start_date: startDate, end_date: endDate },

            success: function(response) {
                console.log(response);
                drawChart(response);
            },

            error: function(xhr, status, error) {
                console.error(xhr.responseText);
            }
        });
    }

    function mesChart() {
        var mesSeleccionado = $('#mesSelector').val();
        generateChartMensual(mesSeleccionado);
    }

    function generateChartMensual(mesSeleccionado) {
        var url = '/tpFinal/administrador/cantidadJugadorPorSexoMes';

        $.ajax({
            url: url,
            type: 'GET',
            dataType: 'json',
            data: { month: mesSeleccionado },

            success: function(response) {
                console.log(response);
                drawChart(response);
            },

            error: function(xhr, status, error) {
                console.error(xhr.responseText);
            }
        });
    }

    function anioChart(){
        var anioSeleccionado = $('#anioSelector').val();
        generateChartAnual(anioSeleccionado);
    }
    function generateChartAnual(anioSeleccionado) {
        var url = '/tpFinal/administrador/cantidadJugadorPorSexoAnio';

        $.ajax({
            url: url,
            type: 'GET',
            dataType: 'json',
            data: { year: anioSeleccionado},

            success: function(response) {
                console.log(response);
                drawChart(response);
            },

            error: function(xhr, status, error) {
                console.error(xhr.responseText);
            }
        });
    }

    function drawChart(data) {

        var chartData = new google.visualization.DataTable();
        chartData.addColumn('string', 'Sexo');
        chartData.addColumn('number', 'Jugadores');

        chartData.addRow(['Masculino', data.cantidadJugadoresM]);
        chartData.addRow(['Femenino', data.cantidadJugadoresF]);
        chartData.addRow(['Otro', data.cantidadJugadoresOtro]);

        var options = {
            legend: { position: 'bottom' },
            width: Math.floor(window.innerWidth * 0.95),
            height: 400,
            hAxis: {
                format: '0'
            },
            vAxis: {
                format: '0'
            }
        };

        var chart = new google.visualization.ColumnChart(document.getElementById('chart_div'));
        chart.draw(chartData, options);
    }
</script>
</body>
</html>
